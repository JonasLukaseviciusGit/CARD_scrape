import praw
import passwords
import json

# Replace these with your own API keys and user information
client_id = passwords.client_id
client_secret = passwords.client_secret
user_agent = passwords.user_agent
username = passwords.username
password = passwords.password

# Initialize the Reddit API client
reddit = praw.Reddit(
    client_id=client_id,
    client_secret=client_secret,
    user_agent=user_agent,
    username=username,
    password=password
)

def parse_comment(comment):
    comment_data = {
        'comment_id': comment.id,
        'user_who_posted': comment.author.name if comment.author else None,
        'timestamp_commented': comment.created_utc,
        'votes': comment.score,
        'text': comment.body,
        'replies': []
    }
    for reply in comment.replies:
        if isinstance(reply, praw.models.Comment):
            comment_data['replies'].append(parse_comment(reply))
    return comment_data

def get_post_details(post_id):
    try:
        submission = reddit.submission(id=post_id)
        post_url = submission.url
        post_author = submission.author
        post_author_details = {
            'username': post_author.name,
            'karma': post_author.link_karma,
            'created_at': post_author.created_utc
        }
        post_timestamp = submission.created_utc
        post_header = submission.title
        post_votes = submission.score
        post_text = submission.selftext

        # Get comments for the post
        comments = []
        for comment in submission.comments:
            if isinstance(comment, praw.models.Comment):
                comments.append(parse_comment(comment))

        post_details = {
            'url': post_url,
            'user_who_posted_this': post_author.name,
            'details_about_the_user_who_posted_this': post_author_details,
            'when_it_was_posted_timestamp': post_timestamp,
            'header': post_header,
            'votes': post_votes,
            'text': post_text,
            'comments': comments
        }

        return post_details

    except praw.exceptions.RedditAPIException as e:
        print(f"An error occurred: {e}")
        return None

post_id = '17pjl8h'  # Replace with the desired post ID
post_details = get_post_details(post_id)

if post_details:
    print(json.dumps(post_details, indent=4))
